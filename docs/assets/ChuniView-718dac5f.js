import{_ as C,r as x,o as _,c as M,a as f,b as i,w as d,d as b,e as k,F as y,f as w}from"./index-f5502190.js";const R={data(){return{headMessageType:"warning",connected:!1,lastmessage:"请选择端口",sliderType:1,portNum:null,eepromAddr:255,eepromValue:0,lightColor:"#000000",brightness:10,keyType:1,keyTypeMark:{1:"32k",2:"16k",3:"8k",4:"4k"},brightnessMark:{0:"关闭",1:"10%",2:"20%",3:"30%",4:"40%",5:"50%",6:"60%",7:"70%",8:"80%",9:"90%",10:"100%"},sensitive:8,sensiStep:1,sensiMin:8,sensiMax:12,sensiMarks0:{16:"极高",24:"超高",32:"高",40:"一般",48:"低",56:"较低",64:"非常低"},sensiMarks1:{7:"极高",8:"超高",9:"高",10:"一般",11:"低",12:"较低",13:"非常低"},sensiMarks:{16:"极高",24:"超高",32:"高",40:"一般",48:"低",56:"较低",64:"非常低"},debugEnabledCount:0,debugEnabled:!1}},methods:{debugenable(){this.debugEnabledCount+=1,this.debugEnabledCount>=5&&(this.debugEnabled=!0)},getWriteRomPacket(e,r){return new Uint8Array([33,64,35,35,28,e,0,r,r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},getHelloPacket(){return new Uint8Array([33,64,35,35,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},getReadRomPacket(e){return new Uint8Array([33,64,35,35,29,e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},async readEEPROM(){let e=this;var r=e.portNum.writable.getWriter(),n=e.portNum.readable.getReader(),o=e.getReadRomPacket(e.eepromAddr);await r.write(o);for(var a=0,l="";a<=2;){var t=await n.read();a++;for(var s in t.value)String.fromCharCode(t.value[s])!="A"&&(l=l+String.fromCharCode(t.value[s]))}e.eepromValue=parseInt(l),n.releaseLock(),r.releaseLock()},async writeEEPROM(){let e=this;var r=e.portNum.writable.getWriter(),n=e.getWriteRomPacket(e.eepromAddr,e.eepromValue);await r.write(n),r.releaseLock()},async writeSensitive(){let e=this;if(e.connected&&e.portNum!=null){var r=e.portNum.writable.getWriter(),n=e.portNum.readable.getReader(),o=e.getWriteRomPacket(84,e.sensitive);await r.write(o);var a=e.getReadRomPacket(84);await r.write(a);for(var l=0,t="";l<=2;){var s=await n.read();l++;for(var u in s.value)String.fromCharCode(s.value[u])!="A"&&(t=t+String.fromCharCode(s.value[u]))}e.sensitive=parseInt(t),e.sensitive>15?(e.sensiMarks=e.sensiMarks0,e.sensiStep=8,e.sensiMin=16,e.sensiMax=64):(e.sensiMarks=e.sensiMarks1,e.sensiStep=1,e.sensiMin=7,e.sensiMax=13),n.releaseLock(),r.releaseLock(),e.lastmessage="写入成功！灵敏度在下次连接手台时生效。"}},async choosePort(){let e=this;if("serial"in navigator){try{e.portNum=await navigator.serial.requestPort()}catch(v){e.lastmessage="端口选择错误："+v;return}try{await e.portNum.open({baudRate:1e6})}catch(v){e.lastmessage="打开端口错误："+v;return}var r=e.getHelloPacket(),n=e.portNum.writable.getWriter(),o=e.portNum.readable.getReader();await n.write(r);for(var a="",l=!1;a.length<=20&&!l;){var t=await o.read();for(var s in t.value)String.fromCharCode(t.value[s])!="A"&&(a=a+String.fromCharCode(t.value[s])),a.endsWith("XDEN chunicon v2.")&&(l=!0)}var u=e.getReadRomPacket(7);await n.write(u);for(var m=0,g="";m<=2;){var t=await o.read();m++;for(var s in t.value)String.fromCharCode(t.value[s])!="A"&&(g=g+String.fromCharCode(t.value[s]))}var h=e.getReadRomPacket(84);await n.write(h);for(var m=0,p="";m<=2;){var t=await o.read();m++;for(var s in t.value)String.fromCharCode(t.value[s])!="A"&&(p=p+String.fromCharCode(t.value[s]))}e.sensitive=parseInt(p),e.sensitive>15?(e.sensiMarks=e.sensiMarks0,e.sensiStep=8,e.sensiMin=16,e.sensiMax=64):(e.sensiMarks=e.sensiMarks1,e.sensiStep=1,e.sensiMin=7,e.sensiMax=13),e.lastmessage="已选择控制器: XDEN chunicon v2. 固件版本: "+g,e.headMessageType="success",o.releaseLock(),n.releaseLock(),e.connected=!0}else e.lastmessage="您的浏览器不支持串口通信，请使用chrome浏览器。"}}},E={slot:"header"},P=f("span",null,"灵敏度配置",-1),S=f("div",{slot:"header"},[f("span",null,"危险区域！")],-1);function N(e,r,n,o,a,l){const t=x("el-divider"),s=x("el-button"),u=x("el-col"),g=x("el-alert"),h=x("el-row"),m=x("el-slider"),p=x("el-card");x("el-color-picker");const v=x("el-input-number");return _(),M(y,null,[f("h2",{onClick:r[0]||(r[0]=(...c)=>l.debugenable&&l.debugenable(...c))},"控制器配置"),i(t),i(h,null,{default:d(()=>[i(u,{span:4},{default:d(()=>[i(s,{onClick:l.choosePort,disabled:a.connected},{default:d(()=>[w("连接控制器")]),_:1},8,["onClick","disabled"])]),_:1}),i(u,{span:20},{default:d(()=>[i(g,{title:a.lastmessage,type:a.headMessageType,closable:!1},null,8,["title","type"])]),_:1})]),_:1}),i(t),a.connected?(_(),b(p,{key:0},{default:d(()=>[f("div",E,[P,i(s,{style:{float:"right"},type:"primary",disabled:!a.connected,onClick:l.writeSensitive},{default:d(()=>[w("写入灵敏度")]),_:1},8,["disabled","onClick"])]),i(m,{modelValue:a.sensitive,"onUpdate:modelValue":r[1]||(r[1]=c=>a.sensitive=c),"show-tooltip":!1,step:a.sensiStep,min:a.sensiMin,marks:a.sensiMarks,max:a.sensiMax},null,8,["modelValue","step","min","marks","max"])]),_:1})):k("",!0),k("",!0),k("",!0),k("",!0),a.connected&&a.debugEnabled?(_(),b(p,{key:4},{default:d(()=>[S,i(v,{modelValue:a.eepromAddr,"onUpdate:modelValue":r[5]||(r[5]=c=>a.eepromAddr=c),min:0,max:255,label:"地址"},null,8,["modelValue"]),i(v,{modelValue:a.eepromValue,"onUpdate:modelValue":r[6]||(r[6]=c=>a.eepromValue=c),min:0,max:255,label:"值"},null,8,["modelValue"]),i(s,{type:"primary",onClick:l.readEEPROM},{default:d(()=>[w("读取")]),_:1},8,["onClick"]),i(s,{type:"danger",onClick:l.writeEEPROM},{default:d(()=>[w("写入")]),_:1},8,["onClick"])]),_:1})):k("",!0)],64)}const A=C(R,[["render",N]]);export{A as default};
