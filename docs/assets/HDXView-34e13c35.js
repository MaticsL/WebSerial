import{_ as y,r as o,o as b,c as k,a as c,b as a,w as n,e as m,d as p,F as E,f as g}from"./index-8c4572c6.js";const C={data(){return{headMessageType:"warning",lastmessage:"请选择设备",selectedArea:"none",portNum:null,connected:!1,halting:!1,touchingArea:[],touchingIntervalID:0,readingData:new Uint8Array,RatioSetting:{area:null,value:null},SensitivitySetting:{area:null,value:null},debugEnabledCount:0,debugEnabled:!1}},methods:{getSensePacket(e,l){var t=new TextEncoder().encode("sen "+e+" "+l+`
`);return console.log(t),t},async addSensitivity(){let e=this;if(e.connected){var l=e.portNum.writable.getWriter(),t=e.getSensePacket("*","-");await l.write(t),l.releaseLock()}},async minusSensitivity(){let e=this;if(e.connected){var l=e.portNum.writable.getWriter(),t=e.getSensePacket("*","+");await l.write(t),l.releaseLock()}},async addAreaSensitivity(){let e=this;if(e.connected){var l=e.portNum.writable.getWriter(),t=e.getSensePacket(e.selectedArea,"-");await l.write(t),l.releaseLock()}},async minusAreaSensitivity(){let e=this;if(e.connected){var l=e.portNum.writable.getWriter(),t=e.getSensePacket(e.selectedArea,"+");await l.write(t),l.releaseLock()}},debugenable(){this.debugEnabledCount+=1,this.debugEnabledCount>=5&&(this.debugEnabled=!0)},submitRatio(){this.RatioSetting.area==null||this.RatioSetting.value==null},submitSensitivity(){},async factoryMode(){let e=this;if("serial"in navigator){try{e.portNum=await navigator.serial.requestPort()}catch(l){e.lastmessage="端口选择错误："+l;return}try{await e.portNum.open({baudRate:1200}),await e.portNum.setSignals({dataTerminalReady:!1})}catch{}e.lastmessage="成功，请检查控制器盘符并放入固件",e.headMessageType="success"}},asciiToUint8(e){let l="";for(let r=0;r<e.length;r++){const u=e.charCodeAt(r).toString(16).padStart(2,"0");l+=u+" "}return l=l.trim(),Uint8Array.from(l.split(" ").map(r=>parseInt(r,16)))},test(){console.log(this.asciiToUint8("{LAr2}"))},async startTouchListening(){let e=this;for(;!this.halting;){let l=e.portNum.getReader();for(;;){const{value:t,done:r}=await l.read();if(r)break;e.readingData=new Uint8Array,t[7]&1&&e.readingData.push("A1"),t[7]&2&&e.readingData.push("A2"),t[7]&4&&e.readingData.push("A3"),t[7]&8&&e.readingData.push("A4"),t[7]&16&&e.readingData.push("A5"),t[6]&1&&e.readingData.push("A6"),t[6]&2&&e.readingData.push("A7"),t[6]&4&&e.readingData.push("A8"),t[6]&8&&e.readingData.push("B1"),t[6]&16&&e.readingData.push("B2"),t[5]&1&&e.readingData.push("B3"),t[5]&2&&e.readingData.push("B4"),t[5]&4&&e.readingData.push("B5"),t[5]&8&&e.readingData.push("B6"),t[5]&16&&e.readingData.push("B7"),t[4]&1&&e.readingData.push("B8"),t[4]&2&&e.readingData.push("C1"),t[4]&4&&e.readingData.push("C2"),t[4]&8&&e.readingData.push("D1"),t[4]&16&&e.readingData.push("D2"),t[3]&1&&e.readingData.push("D3"),t[3]&2&&e.readingData.push("D4"),t[3]&4&&e.readingData.push("D5"),t[3]&8&&e.readingData.push("D6"),t[3]&16&&e.readingData.push("D7"),t[2]&1&&e.readingData.push("D8"),t[2]&2&&e.readingData.push("E1"),t[2]&4&&e.readingData.push("E2"),t[2]&8&&e.readingData.push("E3"),t[2]&16&&e.readingData.push("E4"),t[1]&1&&e.readingData.push("E5"),t[1]&2&&e.readingData.push("E6"),t[1]&4&&e.readingData.push("E7"),t[1]&8&&e.readingData.push("E8")}}},async senseMode(){let e=this;if("serial"in navigator){try{e.portNum=await navigator.serial.requestPort()}catch(l){e.lastmessage="端口选择错误："+l;return}try{await e.portNum.open({baudRate:1e6})}catch(l){e.lastmessage="打开端口错误："+l;return}e.connected=!0,e.lastmessage="成功连接"}},async choosePort(){let e=this;if(this.connected==!0){this.halting==!0?(this.asciiToUint8("{STAT}"),this.halting=!this.halting,e.lastmessage="退出配置设置",this.startTouchListening()):(this.asciiToUint8("{HALT}"),this.halting=!this.halting,e.lastmessage="退出屏幕测试");return}if("serial"in navigator){try{e.portNum=await navigator.serial.requestPort()}catch(s){e.lastmessage="端口选择错误："+s;return}try{await e.portNum.open({baudRate:1e6})}catch(s){e.lastmessage="打开端口错误："+s;return}e.connecting=!0,e.connectPercentage=0;let l=e.asciiToUint8("{RSET}"),t=e.asciiToUint8("{HALT}"),r=e.portNum.writable.getWriter();await r.write(l),await r.write(t),connected=!connected,e.lastmessage="成功连接",e.headMessageType="success",e.startTouchListening()}else e.lastmessage="您的浏览器不支持串口通信，请使用chrome浏览器。"}}},B=c("br",null,null,-1),S=c("br",null,null,-1),T=c("h2",null,"修改全部灵敏度",-1),N=c("br",null,null,-1),x=c("h2",null,"修改区域灵敏度",-1),L=c("br",null,null,-1);function P(e,l,t,r,s,u){const w=o("el-divider"),v=o("el-alert"),d=o("el-button"),h=o("el-col"),D=o("el-row"),_=o("el-card"),i=o("el-option"),A=o("el-select");return b(),k(E,null,[c("h2",{onClick:l[0]||(l[0]=(...f)=>u.debugenable&&u.debugenable(...f))},"HDX 配置"),a(w),a(v,{title:"提示",type:"info",description:"本页面提供 HDX 乌蒙风格控制器的配置功能。请确认您的控制器符合这个版本。完成配置后，您可以直接关闭这个页面。","show-icon":""}),B,a(D,null,{default:n(()=>[a(h,{span:4},{default:n(()=>[a(d,{onClick:u.factoryMode},{default:n(()=>[g("进入刷机模式")]),_:1},8,["onClick"])]),_:1}),a(h,{span:4},{default:n(()=>[a(d,{onClick:u.senseMode},{default:n(()=>[g("修改灵敏度")]),_:1},8,["onClick"])]),_:1}),p("",!0),a(h,{span:16},{default:n(()=>[a(v,{title:s.lastmessage,type:s.headMessageType,closable:!1},null,8,["title","type"])]),_:1})]),_:1}),S,s.connected?(b(),m(_,{key:0,id:"screen-testing"},{default:n(()=>[T,a(d,{span:4,onClick:u.addSensitivity},{default:n(()=>[g(" 提高灵敏度 ")]),_:1},8,["onClick"]),a(d,{span:4,onClick:u.minusSensitivity},{default:n(()=>[g(" 降低灵敏度 ")]),_:1},8,["onClick"])]),_:1})):p("",!0),N,s.connected?(b(),m(_,{key:1,id:"screen-testing"},{default:n(()=>[x,a(D,{gutter:20},{default:n(()=>[a(h,{span:8},{default:n(()=>[a(A,{modelValue:s.selectedArea,"onUpdate:modelValue":l[1]||(l[1]=f=>s.selectedArea=f),placeholder:"触摸区域",inline:!0},{default:n(()=>[a(i,{label:"A1",value:"A1"}),a(i,{label:"A2",value:"A2"}),a(i,{label:"A3",value:"A3"}),a(i,{label:"A4",value:"A4"}),a(i,{label:"A5",value:"A5"}),a(i,{label:"A6",value:"A6"}),a(i,{label:"A7",value:"A7"}),a(i,{label:"A8",value:"A8"}),a(i,{label:"B1",value:"B1"}),a(i,{label:"B2",value:"B2"}),a(i,{label:"B3",value:"B3"}),a(i,{label:"B4",value:"B4"}),a(i,{label:"B5",value:"B5"}),a(i,{label:"B6",value:"B6"}),a(i,{label:"B7",value:"B7"}),a(i,{label:"B8",value:"B8"}),a(i,{label:"C1",value:"C1"}),a(i,{label:"C2",value:"C2"}),a(i,{label:"D1",value:"D1"}),a(i,{label:"D2",value:"D2"}),a(i,{label:"D3",value:"D3"}),a(i,{label:"D4",value:"D4"}),a(i,{label:"D5",value:"D5"}),a(i,{label:"D6",value:"D6"}),a(i,{label:"D7",value:"D7"}),a(i,{label:"D8",value:"D8"}),a(i,{label:"E1",value:"E1"}),a(i,{label:"E2",value:"E2"}),a(i,{label:"E3",value:"E3"}),a(i,{label:"E4",value:"E4"}),a(i,{label:"E5",value:"E5"}),a(i,{label:"E6",value:"E6"}),a(i,{label:"E7",value:"E7"}),a(i,{label:"E8",value:"E8"})]),_:1},8,["modelValue"])]),_:1}),a(h,{span:8},{default:n(()=>[a(d,{span:4,onClick:u.addAreaSensitivity},{default:n(()=>[g(" 提高灵敏度 ")]),_:1},8,["onClick"]),a(d,{span:4,onClick:u.minusAreaSensitivity},{default:n(()=>[g(" 降低灵敏度 ")]),_:1},8,["onClick"])]),_:1})]),_:1}),L]),_:1})):p("",!0),p("",!0),p("",!0)],64)}const U=y(C,[["render",P]]);export{U as default};
