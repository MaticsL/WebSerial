import{_ as M,r as g,o as f,c as S,a as d,b as i,w as x,d as h,e as k,F as T,f as _}from"./index-8c4572c6.js";const W={data(){return{headMessageType:"warning",firmVersion:0,connecting:!1,connected:!1,zhou_io_enabled:!0,keyboard_enabled:!1,lastmessage:"请选择设备",sliderType:1,portNum:null,eepromAddr:255,connectPercentage:0,eepromValue:0,lightColor:"#000000",brightness:250,keyType:1,closeColor:"#000000",keyTypeMark:{1:"32k",2:"16k",3:"8k",4:"4k"},brightnessMark:{0:"关闭",1:"10%",2:"20%",3:"30%",4:"40%",5:"50%",6:"60%",7:"70%",8:"80%",9:"90%",10:"100%"},sensitive:20,sensiStep:1,sensiMin:10,sensiMax:64,debugEnabledCount:0,debugEnabled:!1}},methods:{debugenable(){this.debugEnabledCount+=1,this.debugEnabledCount>=5&&(this.debugEnabled=!0)},getWriteRomPacket(e,t){return new Uint8Array([33,64,35,35,28,e,0,t,t,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},getHelloPacket(){return new Uint8Array([33,64,35,35,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},getReadRomPacket(e){return new Uint8Array([33,64,35,35,29,e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},async readEEPROM(){let e=this;var t=e.portNum.writable.getWriter(),o=e.portNum.readable.getReader(),s=e.getReadRomPacket(e.eepromAddr);await t.write(s);for(var a=0,n="";a<=2;){var r=await o.read();a++;for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(n=n+String.fromCharCode(r.value[l]))}e.eepromValue=parseInt(n),o.releaseLock(),t.releaseLock()},async writeEEPROM(){let e=this;var t=e.portNum.writable.getWriter(),o=e.getWriteRomPacket(e.eepromAddr,e.eepromValue);await t.write(o),t.releaseLock()},async writeKeyLayout(){let e=this;if(e.connected&&e.portNum!=null){var t=e.portNum.writable.getWriter(),o=e.portNum.readable.getReader(),s=e.getWriteRomPacket(94,e.keyType);await t.write(s);var a=e.getReadRomPacket(94);await t.write(a);for(var n=0,r="";n<=2;){var l=await o.read();n++;for(var m in l.value)r=r+String.fromCharCode(l.value[m])}e.keyType=parseInt(r),o.releaseLock(),t.releaseLock(),e.lastmessage="写入成功！键型在下次连接手台时生效。"}},async writeBrightness(){let e=this;if(e.connected&&e.portNum!=null){var t=e.portNum.writable.getWriter(),o=e.portNum.readable.getReader(),s=e.getWriteRomPacket(98,e.brightness);await t.write(s);var a=e.getReadRomPacket(98);await t.write(a);for(var n=0,r="";n<=2;){var l=await o.read();n++;for(var m in l.value)r=r+String.fromCharCode(l.value[m])}e.brightness=parseInt(r),o.releaseLock(),t.releaseLock(),e.lastmessage="写入成功！亮度在下次连接手台时生效。"}},async writeInput(){let e=this;if(e.connected&&e.portNum!=null){var t=e.portNum.writable.getWriter(),o=e.portNum.readable.getReader(),s,a;e.zhou_io_enabled?s=e.getWriteRomPacket(101,1):s=e.getWriteRomPacket(101,2),e.keyboard_enabled?a=e.getWriteRomPacket(100,1):a=e.getWriteRomPacket(100,2),await t.write(s);for(var n=0;n<3;)await o.read(),n++;await t.write(a),o.releaseLock(),t.releaseLock(),e.lastmessage="写入成功！输出模式在下次连接手台时生效。"}},async writeSensitive(){let e=this;if(e.connected&&e.portNum!=null){var t=e.portNum.writable.getWriter(),o=e.portNum.readable.getReader(),s=e.getWriteRomPacket(84,e.sensitive);await t.write(s);var a=e.getReadRomPacket(84);await t.write(a);for(var n=0,r="";n<=2;){var l=await o.read();n++;for(var m in l.value)r=r+String.fromCharCode(l.value[m])}e.sensitive=parseInt(r),o.releaseLock(),t.releaseLock(),e.lastmessage="写入成功！灵敏度在下次连接手台时生效。"}},async choosePort(){let e=this;if("serial"in navigator){try{e.portNum=await navigator.serial.requestPort()}catch(N){e.lastmessage="端口选择错误："+N;return}try{await e.portNum.open({baudRate:1e6})}catch(N){e.lastmessage="打开端口错误："+N;return}e.connecting=!0,e.connectPercentage=0;var t=e.getHelloPacket(),o=e.portNum.writable.getWriter(),s=e.portNum.readable.getReader();await o.write(t);for(var a="",n=!1;a.length<=27&&!n;){var r=await s.read();for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(a=a+String.fromCharCode(r.value[l])),a.endsWith("XDEN chunicon v3-32 model 2.")&&(n=!0),a.endsWith("XDEN chunicon v3-32 model 1.")&&(n=!0)}if(!n){e.lastmessage="打开端口错误：请选择正确的设备!";return}e.connectPercentage=20;var m=e.getReadRomPacket(7);await o.write(m);for(var c=0,v="";c<=2;){var r=await s.read();c++;for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(v=v+String.fromCharCode(r.value[l]))}e.connectPercentage=40;var R=e.getReadRomPacket(101);await o.write(R);for(var c=0,w="";c<=1;){var r=await s.read();c++;for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(w=w+String.fromCharCode(r.value[l]))}w*1==1?e.zhou_io_enabled=!0:e.zhou_io_enabled=!1;var C=e.getReadRomPacket(100);await o.write(C);for(var c=0,p="";c<=1;){var r=await s.read();c++;for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(p=p+String.fromCharCode(r.value[l]))}p*1==1?e.keyboard_enabled=!0:e.keyboard_enabled=!1,e.connectPercentage=50;var y=e.getReadRomPacket(84);await o.write(y);for(var c=0,b="";c<=2;){var r=await s.read();c++;for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(b=b+String.fromCharCode(r.value[l]))}e.sensitive=parseInt(b),e.connectPercentage=70;var u=e.getReadRomPacket(98);await o.write(u);for(var c=0,P="";c<=2;){var r=await s.read();c++;for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(P=P+String.fromCharCode(r.value[l]))}e.brightness=parseInt(P),(e.brightness>255||e.brightness<0)&&(e.brightness=255),e.connectPercentage=80;var E=e.getReadRomPacket(94);await o.write(E);for(var c=0,V="";c<=2;){var r=await s.read();c++;for(var l in r.value)String.fromCharCode(r.value[l])!="A"&&(V=V+String.fromCharCode(r.value[l]))}e.connectPercentage=90,e.keyType=parseInt(V),(e.keyType>4||e.keyType<1)&&(e.keyType=1),e.connecting=!1,e.lastmessage="已选择控制器: XDEN chunicon v2. 固件版本: "+v,e.firmVersion=parseInt(v),e.headMessageType="success",s.releaseLock(),o.releaseLock(),e.connected=!0}else e.lastmessage="您的浏览器不支持串口通信，请使用chrome浏览器。"},async factoryMode(){let e=this;if("serial"in navigator){try{e.portNum=await navigator.serial.requestPort()}catch(t){e.lastmessage="端口选择错误："+t;return}try{await e.portNum.open({baudRate:1200}),await e.portNum.setSignals({dataTerminalReady:!1})}catch(t){e.lastmessage="打开端口错误："+t;return}e.lastmessage="成功，请检查控制器盘符并放入固件",e.headMessageType="success"}}}},A=d("br",null,null,-1),L={key:0},I={slot:"header"},U=d("span",null,"输出配置",-1),z=d("br",null,null,-1),B=d("br",null,null,-1),O={slot:"header"},D=d("span",null,"灵敏度阈值配置",-1),H=d("br",null,null,-1),X=d("br",null,null,-1),j={slot:"header"},q=d("span",null,"亮度配置",-1),F=d("br",null,null,-1),J={slot:"header"},K=d("span",null,"键型配置",-1),Q=d("br",null,null,-1),Y=d("div",{slot:"header"},[d("span",null,"危险区域！")],-1);function Z(e,t,o,s,a,n){const r=g("el-divider"),l=g("el-alert"),m=g("el-button"),v=g("el-col"),R=g("el-row"),w=g("el-progress"),C=g("el-checkbox"),p=g("el-card"),y=g("el-slider");g("el-color-picker");const b=g("el-input-number");return f(),S(T,null,[d("h2",{onClick:t[0]||(t[0]=(...u)=>n.debugenable&&n.debugenable(...u))},"chuni32寸控制器配置"),i(r),i(l,{title:"提示",type:"info",description:"本页面提供 chun32 寸控制器的配置功能。请确认您的控制器符合这个版本。完成配置后，您可以直接关闭这个页面。","show-icon":""}),A,i(R,null,{default:x(()=>[i(v,{span:4},{default:x(()=>[i(m,{onClick:n.factoryMode,disabled:a.connected},{default:x(()=>[_("进入刷机模式")]),_:1},8,["onClick","disabled"])]),_:1}),i(v,{span:4},{default:x(()=>[i(m,{onClick:n.choosePort,disabled:a.connected},{default:x(()=>[_("连接控制器")]),_:1},8,["onClick","disabled"])]),_:1}),i(v,{span:16},{default:x(()=>[i(l,{title:a.lastmessage,type:a.headMessageType,closable:!1},null,8,["title","type"])]),_:1})]),_:1}),a.connecting?(f(),S("br",L)):h("",!0),a.connecting?(f(),k(w,{key:1,percentage:a.connectPercentage},null,8,["percentage"])):h("",!0),i(r),a.connected?(f(),k(p,{key:2},{default:x(()=>[d("div",I,[U,i(m,{style:{float:"right"},type:"primary",disabled:!a.connected,onClick:n.writeInput},{default:x(()=>[_("写入输出配置")]),_:1},8,["disabled","onClick"])]),z,i(l,{title:"提示",type:"info",description:"手台可以调节输出键盘按键或舟HID，请根据需要选择，也可以都输出。","show-icon":""}),d("div",null,[i(C,{modelValue:a.zhou_io_enabled,"onUpdate:modelValue":t[1]||(t[1]=u=>a.zhou_io_enabled=u),label:"舟io",border:"",size:"large"},null,8,["modelValue"]),i(C,{modelValue:a.keyboard_enabled,"onUpdate:modelValue":t[2]||(t[2]=u=>a.keyboard_enabled=u),label:"键盘输出",border:"",size:"large"},null,8,["modelValue"])])]),_:1})):h("",!0),B,a.connected?(f(),k(p,{key:3},{default:x(()=>[d("div",O,[D,i(m,{style:{float:"right"},type:"primary",disabled:!a.connected,onClick:n.writeSensitive},{default:x(()=>[_("写入灵敏度")]),_:1},8,["disabled","onClick"])]),H,i(l,{title:"提示",type:"info",description:"向左升高灵敏度，向右降低灵敏度。","show-icon":""}),i(y,{modelValue:a.sensitive,"onUpdate:modelValue":t[3]||(t[3]=u=>a.sensitive=u),"show-tooltip":!0,step:a.sensiStep,min:a.sensiMin,max:a.sensiMax,"show-input":""},null,8,["modelValue","step","min","max"])]),_:1})):h("",!0),X,a.firmVersion>=10?(f(),k(p,{key:4},{default:x(()=>[d("div",j,[q,i(m,{style:{float:"right"},type:"primary",disabled:!a.connected,onClick:n.writeBrightness},{default:x(()=>[_("写入亮度配置")]),_:1},8,["disabled","onClick"])]),i(y,{modelValue:a.brightness,"onUpdate:modelValue":t[4]||(t[4]=u=>a.brightness=u),"show-tooltip":!1,step:1,min:0,marks:a.brightnessMark,max:10},null,8,["modelValue","marks"])]),_:1})):h("",!0),F,h("",!0),a.firmVersion>=11?(f(),k(p,{key:6},{default:x(()=>[d("div",J,[K,i(m,{style:{float:"right"},type:"primary",disabled:!a.connected,onClick:n.writeKeyLayout},{default:x(()=>[_("写入键型配置")]),_:1},8,["disabled","onClick"])]),Q,i(l,{title:"提示",type:"info",description:"键型：32k为几乎覆盖全键盘，8k为asdfjkl;，4k为dfjk。","show-icon":""}),i(y,{modelValue:a.keyType,"onUpdate:modelValue":t[7]||(t[7]=u=>a.keyType=u),"show-tooltip":!1,step:1,min:1,marks:a.keyTypeMark,max:4},null,8,["modelValue","marks"])]),_:1})):h("",!0),a.connected&&a.debugEnabled?(f(),k(p,{key:7},{default:x(()=>[Y,i(b,{modelValue:a.eepromAddr,"onUpdate:modelValue":t[8]||(t[8]=u=>a.eepromAddr=u),min:0,max:255,label:"地址"},null,8,["modelValue"]),i(b,{modelValue:a.eepromValue,"onUpdate:modelValue":t[9]||(t[9]=u=>a.eepromValue=u),min:0,max:255,label:"值"},null,8,["modelValue"]),i(m,{type:"primary",onClick:n.readEEPROM},{default:x(()=>[_("读取")]),_:1},8,["onClick"]),i(m,{type:"danger",onClick:n.writeEEPROM},{default:x(()=>[_("写入")]),_:1},8,["onClick"])]),_:1})):h("",!0)],64)}const $=M(W,[["render",Z]]);export{$ as default};
